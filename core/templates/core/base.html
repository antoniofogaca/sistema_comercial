{# core/templates/core/base.html #}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Sistema de Convênio{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background-color: #f8f9fa; /* Cor de fundo para toda a página */
        }

        .wrapper {
            display: flex;
            height: 100vh;
            overflow: hidden; /* Mantido para o modo desktop */
        }

        .sidebar {
            width: 250px;
            background-color: #343a40;
            color: white;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            transition: width 0.3s ease-in-out;
            position: relative; /* Garante o contexto de empilhamento */
            z-index: 1020;      /* Z-index alto para ficar sobre todo o conteúdo */
        }

        .sidebar.collapsed {
            width: 70px;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.25rem;
            border-bottom: 1px solid #495057;
            min-height: 60px; /* Altura mínima para consistência */
        }

        .sidebar-header h4 {
            margin: 0;
            font-size: 1.1rem;
            white-space: nowrap; /* Evita quebra de linha do título */
            opacity: 1;
            transition: opacity 0.3s ease-in-out;
        }

        .sidebar.collapsed .sidebar-header h4 {
            opacity: 0; /* Esconde o título suavemente */
            display: none;
        }

        .sidebar.collapsed .sidebar-header {
            justify-content: center; /* Centraliza o botão quando recolhido */
        }

        .sidebar a {
            color: white;
            text-decoration: none;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 15px; /* Aumenta o espaçamento entre ícone e texto */
            transition: background-color 0.2s;
            white-space: nowrap;
        }

        .sidebar a .fa-fw {
            width: 1.25em; /* Garante alinhamento dos ícones */
        }

        .sidebar a span, .sidebar a .ms-auto {
            transition: opacity 0.3s ease;
        }

        .sidebar.collapsed a span,
        .sidebar.collapsed a .ms-auto {
            display: none; /* Esconde o texto e a seta do acordeão */
        }

        .sidebar.collapsed a {
            justify-content: center; /* Centraliza o ícone */
            padding: 12px 10px; /* Ajusta o padding lateral */
        }

        .sidebar a:hover {
            background-color: #495057;
        }

        .sidebar a.active {
            background-color: #0d6efd;
        }

        .content {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto; /* Permite scroll apenas no conteúdo em desktop */
        }

        .toggle-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .list-group-flush .list-group-item {
            background-color: transparent !important;
            color: white !important;
            border-color: rgba(255, 255, 255, 0.1) !important;
        }

        .list-group-flush .list-group-item:hover {
            background-color: #495057 !important;
        }

        .list-group-flush .list-group-item.active {
            background-color: #0d6efd !important;
        }

        /* --- MEDIA QUERY PARA RESPONSIVIDADE --- */
        @media (max-width: 768px) {
            .wrapper {
                flex-direction: column;
                height: auto; /* Permite que o wrapper cresça com o conteúdo */
                overflow: visible; /* Permite rolagem normal da página */
            }

            .sidebar {
                width: 100%;
                height: auto;
                flex-direction: row;
                flex-wrap: wrap; /* Permite que os itens do menu quebrem para a próxima linha */
            }

            .sidebar.collapsed {
                width: 100%; /* Em telas pequenas, 'collapsed' não tem efeito de largura */
            }

            .sidebar-header {
                width: 100%;
                justify-content: center;
            }

            .sidebar-header h4 {
                opacity: 1; /* Garante que o título esteja sempre visível */
                display: block;
            }

            .toggle-btn {
                display: none; /* Esconde o botão de toggle em telas pequenas */
            }

            .sidebar a {
                flex-grow: 1; /* Faz os links ocuparem espaço */
                justify-content: center;
                min-width: 150px; /* Largura mínima para cada item */
            }

            .sidebar a span,
            .sidebar.collapsed a span,
            .sidebar a .ms-auto,
            .sidebar.collapsed a .ms-auto {
                display: inline-block !important; /* Garante que o texto e setas estejam visíveis */
            }

            .sidebar.collapsed a {
                justify-content: center; /* Mantém a centralização */
            }

            .content {
                overflow-y: visible; /* Conteúdo não precisa de sua própria barra de rolagem */
            }
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h4>Sistema de Convênio</h4>
                <button class="toggle-btn" onclick="toggleSidebar()"><i class="bi bi-list"></i></button>
            </div>

            {# Menu Auxiliares #}
            <a class="list-group-item list-group-item-action py-2 ripple {% if 'categoria' in request.resolver_match.url_name or 'setor' in request.resolver_match.url_name or 'grupo' in request.resolver_match.url_name or 'cfop' in request.resolver_match.url_name or 'cst_cson' in request.resolver_match.url_name or 'ncm' in request.resolver_match.url_name or 'cest' in request.resolver_match.url_name %}active{% else %}collapsed{% endif %}" data-bs-toggle="collapse" href="#collapseAuxiliares" role="button" aria-expanded="{% if 'categoria' in request.resolver_match.url_name or 'setor' in request.resolver_match.url_name or 'grupo' in request.resolver_match.url_name or 'cfop' in request.resolver_match.url_name or 'cst_cson' in request.resolver_match.url_name or 'ncm' in request.resolver_match.url_name or 'cest' in request.resolver_match.url_name %}true{% else %}false{% endif %}" aria-controls="collapseAuxiliares">
                <i class="fas fa-toolbox fa-fw"></i><span>Auxiliares</span>
                <i class="fas fa-chevron-down ms-auto" style="font-size: 0.8em;"></i>
            </a>
            <div class="collapse {% if 'categoria' in request.resolver_match.url_name or 'setor' in request.resolver_match.url_name or 'grupo' in request.resolver_match.url_name or 'cfop' in request.resolver_match.url_name or 'cst_cson' in request.resolver_match.url_name or 'ncm' in request.resolver_match.url_name or 'cest' in request.resolver_match.url_name %}show{% endif %}" id="collapseAuxiliares" data-bs-parent="#sidebar" style="background-color: #343a40;">
                <div class="list-group list-group-flush border-bottom border-top">
                    <a href="{% url 'core:categoria_list' %}" class="list-group-item list-group-item-action py-2 ripple ps-5 {% if 'categoria' in request.resolver_match.url_name %}active{% endif %}"><i class="fas fa-tags fa-fw"></i><span>Categoria</span></a>
                    <a href="{% url 'core:setor_list' %}" class="list-group-item list-group-item-action py-2 ripple ps-5 {% if 'setor' in request.resolver_match.url_name %}active{% endif %}"><i class="fas fa-sitemap fa-fw"></i><span>Setor</span></a>
                    <a href="{% url 'core:grupo_list' %}" class="list-group-item list-group-item-action py-2 ripple ps-5 {% if 'grupo' in request.resolver_match.url_name %}active{% endif %}"><i class="fas fa-layer-group fa-fw"></i><span>Grupo</span></a>
                    <a href="{% url 'core:cfop_list' %}" class="list-group-item list-group-item-action py-2 ripple ps-5 {% if 'cfop' in request.resolver_match.url_name %}active{% endif %}"><i class="fas fa-list-ol fa-fw"></i><span>Cfop</span></a>
                    <a href="{% url 'core:cst_cson_list' %}" class="list-group-item list-group-item-action py-2 ripple ps-5 {% if 'cst_cson' in request.resolver_match.url_name %}active{% endif %}"><i class="fas fa-receipt fa-fw"></i><span>Cst-Csosn</span></a>
                    <a href="{% url 'core:ncm_list' %}" class="list-group-item list-group-item-action py-2 ripple ps-5 {% if 'ncm' in request.resolver_match.url_name %}active{% endif %}"><i class="fas fa-barcode fa-fw"></i><span>Ncm</span></a>
                    <a href="{% url 'core:cest_list' %}" class="list-group-item list-group-item-action py-2 ripple ps-5 {% if 'cest' in request.resolver_match.url_name %}active{% endif %}"><i class="fas fa-book fa-fw"></i><span>Cest</span></a>
                </div>
            </div>

            {# Menu Convênios #}
            <a class="list-group-item list-group-item-action py-2 ripple {% if 'convenio' in request.resolver_match.url_name %}active{% else %}collapsed{% endif %}" data-bs-toggle="collapse" href="#collapseConvenios" role="button" aria-expanded="{% if 'convenio' in request.resolver_match.url_name %}true{% else %}false{% endif %}" aria-controls="collapseConvenios">
                <i class="fas fa-file-contract fa-fw"></i><span>Convênios</span>
                <i class="fas fa-chevron-down ms-auto" style="font-size: 0.8em;"></i>
            </a>
            <div class="collapse {% if 'convenio' in request.resolver_match.url_name %}show{% endif %}" id="collapseConvenios" data-bs-parent="#sidebar" style="background-color: #343a40;">
                <div class="list-group list-group-flush border-bottom border-top">
                    <a href="{% url 'core:convenio_list' %}" class="list-group-item list-group-item-action py-2 ripple ps-5 {% if 'convenio_list' in request.resolver_match.url_name or 'convenio_create' in request.resolver_match.url_name or 'convenio_update' in request.resolver_match.url_name or 'convenio_delete' in request.resolver_match.url_name %}active{% endif %}"><i class="fas fa-list-ul fa-fw"></i><span>Incluir Convênio</span></a>
                    <a href="{% url 'core:convenio_abertura_list' %}" class="list-group-item list-group-item-action py-2 ripple ps-5 {% if 'convenio_abertura' in request.resolver_match.url_name %}active{% endif %}"><i class="fas fa-calendar-check fa-fw"></i><span>Abertura de Convênio</span></a>
                    <a href="{% url 'core:convenio_emissao_list' %}" class="list-group-item list-group-item-action py-2 ripple ps-5 {% if 'convenio_emissao' in request.resolver_match.url_name %}active{% endif %}"><i class="fas fa-money-check-alt fa-fw"></i><span>Emissão de Convênio</span></a>
                </div>
            </div>

            {# Menu Vendas #}
            <a class="list-group-item list-group-item-action py-2 ripple {% if 'venda' in request.resolver_match.url_name %}active{% else %}collapsed{% endif %}" data-bs-toggle="collapse" href="#collapseVendas" role="button" aria-expanded="{% if 'venda' in request.resolver_match.url_name %}true{% else %}false{% endif %}" aria-controls="collapseVendas">
                <i class="fas fa-shopping-cart fa-fw"></i><span>Vendas</span>
                <i class="fas fa-chevron-down ms-auto" style="font-size: 0.8em;"></i>
            </a>
            <div class="collapse {% if 'venda' in request.resolver_match.url_name %}show{% endif %}" id="collapseVendas" data-bs-parent="#sidebar" style="background-color: #343a40;">
                <div class="list-group list-group-flush border-bottom border-top">
                    <a href="{% url 'core:venda_list' %}" class="list-group-item list-group-item-action py-2 ripple ps-5 {% if 'venda_list' in request.resolver_match.url_name or 'venda_detail' in request.resolver_match.url_name %}active{% endif %}"><i class="fas fa-list-ul fa-fw"></i><span>Lista de Vendas</span></a>
                    <a href="{% url 'core:venda_create' %}" class="list-group-item list-group-item-action py-2 ripple ps-5 {% if 'venda_create' in request.resolver_match.url_name %}active{% endif %}"><i class="fas fa-cash-register fa-fw"></i><span>Nova Venda</span></a>
                </div>
            </div>


            {# Itens de menu simples #}
            <a href="{% url 'core:usuarios_list' %}" class="list-group-item list-group-item-action py-2 ripple {% if 'usuarios' in request.resolver_match.url_name %}active{% endif %}"><i class="fas fa-users fa-fw"></i><span>Usuários</span></a>
            <a href="{% url 'core:clientes_list' %}" class="list-group-item list-group-item-action py-2 ripple {% if 'clientes' in request.resolver_match.url_name %}active{% endif %}"><i class="fas fa-handshake fa-fw"></i><span>Clientes</span></a>
            <a href="{% url 'core:empresas_list' %}" class="list-group-item list-group-item-action py-2 ripple {% if 'empresas' in request.resolver_match.url_name %}active{% endif %}"><i class="fas fa-building fa-fw"></i><span>Empresas</span></a>
            <a href="{% url 'core:produto_list' %}" class="list-group-item list-group-item-action py-2 ripple {% if 'produto' in request.resolver_match.url_name %}active{% endif %}"><i class="fas fa-box fa-fw"></i><span>Produtos</span></a>

            {# Autenticação (Login/Logout) #}
            {% if user.is_authenticated %}
                <a href="{% url 'core:logout' %}" class="list-group-item list-group-item-action py-2 ripple"><i class="bi bi-box-arrow-right fa-fw"></i> <span>Sair</span></a>
            {% else %}
                <a href="{% url 'core:login' %}" class="list-group-item list-group-item-action py-2 ripple"><i class="bi bi-box-arrow-in-right fa-fw"></i> <span>Entrar</span></a>
            {% endif %}
        </nav>

        <main class="content">
            {% if messages %}
                <div class="container-fluid">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
                    </div>
                {% endfor %}
                </div>
            {% endif %}

            {% block content %}{% endblock %}
        </main>
    </div>

    {% block extra_js %}{% endblock %}
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            if (window.innerWidth > 768) { // Apenas executa o toggle em telas grandes
                sidebar.classList.toggle('collapsed');
                // Salva o estado no localStorage
                if (sidebar.classList.contains('collapsed')) {
                    localStorage.setItem('sidebarCollapsed', 'true');
                } else {
                    localStorage.setItem('sidebarCollapsed', 'false');
                }
            }
        }

        // Restaura o estado do menu ao carregar a página
        document.addEventListener('DOMContentLoaded', (event) => {
            if (window.innerWidth > 768) {
                const sidebar = document.getElementById('sidebar');
                if (localStorage.getItem('sidebarCollapsed') === 'true') {
                    sidebar.classList.add('collapsed');
                }
            }
        });
    </script>
</body>
</html>